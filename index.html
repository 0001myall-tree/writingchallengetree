<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¸€ì“°ê¸° ë£¨í‹´ ì±Œë¦°ì§€ ì…ë ¥ê¸° â€” ìŠ¤í”„ë¦°íŠ¸/ë§ˆë¼í†¤/ì•„ì´ë””ì–´</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@500&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
  :root{
    /* ê³ ê¸‰ í†¤ë‹¤ìš´ íŒ”ë ˆíŠ¸ */
    --bg:#f6f5f3;
    --card:#ffffffcc;          /* ì‚´ì§ íˆ¬ëª…ê° */
    --ink:#2b2b2b;
    --muted:#7b7b7b;

    --brand:#6b4de6;           /* í¬ì¸íŠ¸ ì»¬ëŸ¬ ë³´ëë¹› */
    --brand2:#a077ff;
    --ring:rgba(17, 16, 30, .06);

    --ok:#1a7f37;
    --danger:#e23e57;

    /* ìœ ë¦¬ì¹´ë“œ/ê·¸ë¼ë°ì´ì…˜ ê¹Šì´ê° */
    --grad:linear-gradient(135deg, #6b4de6, #a077ff);
    --grad-soft:linear-gradient(180deg, rgba(255,255,255,.6), rgba(255,255,255,.3));
  }

  /* ë² ì´ìŠ¤ */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:'Noto Sans KR', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background:
      radial-gradient(1200px 600px at 10% -10%, #efe9ff 0%, transparent 60%),
      radial-gradient(1000px 500px at 100% 0%, #ffe9f0 0%, transparent 55%),
      var(--bg);
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  }

  /* í—¤ë” */
  header{
    position:relative;
    text-align:center; padding:48px 16px 40px; color:#fff;
    background:var(--grad);
    overflow:hidden;
  }
  header::after{
    content:""; position:absolute; inset:auto -20% -80% -20%; height:180%;
    background:radial-gradient(60% 60% at 50% 40%, rgba(255,255,255,.25), transparent 60%);
    filter:blur(40px);
  }
  header h1{
    margin:0 0 10px; font-family:'Noto Serif KR', serif;
    font-size:32px; letter-spacing:.2px
  }
  header p{margin:0; opacity:.9}

  /* ë ˆì´ì•„ì›ƒ ì¹´ë“œ(ìœ ë¦¬ì¹´ë“œ ëŠë‚Œ) */
  .wrap{max-width:920px; margin:-28px auto 28px; padding:0 16px}
  .card{
    backdrop-filter:saturate(160%) blur(6px);
    background:var(--card);
    border:1px solid rgba(255,255,255,.65);
    border-radius:16px;
    box-shadow:0 20px 40px var(--ring);
    padding:24px; margin-bottom:20px;
  }

  /* í–‰/ìŠ¤íƒ */
  .row{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
  .stack{display:flex; flex-direction:column; gap:16px}

  h2,h3{
    font-family:'Noto Serif KR', serif; margin:0 0 14px;
    color:#3f35a4; letter-spacing:.2px
  }
  label{font-weight:700; font-size:14px; color:#504e62}

  /* í¼ ìš”ì†Œ */
  select,input[type="number"]{
    padding:12px 14px; border:1px solid #e6e2f4; border-radius:12px; font-size:15px;
    background:#fff; min-width:140px; transition:border-color .15s, box-shadow .15s;
  }
  select:focus, input[type="number"]:focus{
    outline:none; border-color:#c7b9ff; box-shadow:0 0 0 5px rgba(163,140,255,.18)
  }

  /* ë²„íŠ¼ */
  button{
    background:var(--grad); color:#fff; border:none;
    border-radius:28px; padding:12px 20px; font-weight:800; letter-spacing:.2px;
    cursor:pointer; transition:.18s transform,.18s box-shadow, filter .18s;
    box-shadow:0 10px 18px rgba(107,77,230,.18);
  }
  button:hover{transform:translateY(-1px); box-shadow:0 16px 28px rgba(107,77,230,.22)}
  button:active{transform:translateY(0)}
  button.ghost{
    background:#ffffff; color:#3b3b3b; border:1px solid #e9e6f7;
    box-shadow:0 6px 14px rgba(0,0,0,.04)
  }
  button.danger{background:linear-gradient(135deg, #e23e57, #ff6a7b); box-shadow:0 10px 18px rgba(226,62,87,.18)}

  /* ë©”íƒ€/í…ìŠ¤íŠ¸ */
  .muted{color:var(--muted)}
  .center{text-align:center}
  .success{color:var(--ok); font-weight:800}
  .fail{color:var(--danger); font-weight:800}
  .hr{height:1px; background:linear-gradient(90deg, #eee 0%, #f6f5ff 50%, #eee 100%); margin:18px 0}

.hidden { display: none !important; }

  /* í†µê³„ ì¹´ë“œ */
  .stats{display:flex; gap:16px; flex-wrap:wrap; justify-content:center; margin-top:8px}
  .stat{
    background:var(--grad-soft); border:1px solid rgba(255,255,255,.7);
    border-radius:12px; padding:12px 14px; min-width:160px; text-align:center;
    box-shadow:0 8px 18px var(--ring)
  }
  .timer{font-size:24px; font-weight:900; color:#e23e57; letter-spacing:.5px}

  /* ì—ë””í„° */
  textarea{
    width:100%; min-height:360px; padding:18px 16px; font-size:16.5px; line-height:1.7;
    border:1px solid #ece8ff; border-radius:14px; resize:vertical; background:#fff;
    transition:border-color .15s, box-shadow .15s;
  }
  textarea:focus{border-color:#c7b9ff; box-shadow:0 0 0 6px rgba(163,140,255,.16)}

  /* ì§„í–‰ë¥  ë°” */
  .progress-wrap{width:100%; background:#f3f0ff; border-radius:12px; overflow:hidden; height:14px; border:1px solid #e8e3ff}
  .progress-bar{height:100%; width:0%; background:linear-gradient(90deg, #6b4de6, #a077ff); transition:width .2s ease}
  .progress-line{display:flex; justify-content:space-between; font-size:13px; color:#5d5778; margin-bottom:8px}

  /* ë‚œì´ë„ ë¸”ë¡(ë” ë˜ë ·í•˜ê²Œ êµ¬ë¶„) */
  .difficulty-block{
    display:flex; align-items:center; gap:12px; padding:12px 0
  }
  .difficulty-block + .difficulty-block{
    border-top:1px dashed #e6e2f4; margin-top:8px; padding-top:18px
  }

  /* ê³µìœ  ë²„íŠ¼ */
  .share-buttons{display:flex; justify-content:center; gap:12px; margin-top:18px; flex-wrap:wrap}
  .share-buttons button{
    padding:10px 16px; border-radius:22px; font-size:14px;
    background:#fff; color:#3f35a4; border:1px solid #e8e3ff;
    box-shadow:0 6px 12px rgba(63,53,164,.06)
  }
  .share-buttons button:hover{filter:brightness(1.02)}

  /* ë°˜ì‘í˜• */
  @media (max-width:640px){
    header h1{font-size:24px}
    .stat{min-width:140px}
    textarea{min-height:320px}
  }

  /* ë‹¤í¬ ëª¨ë“œ(ì‹œìŠ¤í…œ ì—°ë™) */
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#12121a; --ink:#e9e9ef; --muted:#a6a6b3;
      --card:rgba(22,22,32,.6); --ring:rgba(0,0,0,.5);
    }
    header::after{filter:blur(60px); opacity:.6}
    .card{border:1px solid rgba(255,255,255,.12)}
    select, input[type="number"], textarea{background:#171726; color:var(--ink); border-color:#2a2740}
    textarea:focus{box-shadow:0 0 0 6px rgba(107,77,230,.25)}
    .progress-wrap{background:#1c1b2a; border-color:#2a2740}
    .share-buttons button{background:#181828; color:#cfcaff; border-color:#2a2740}
    .difficulty-block + .difficulty-block{border-top-color:#2a2740}
  }
</style>
</head>
<body>
  <header>
    <h1>ê¸€ì“°ê¸° ë£¨í‹´ ì±Œë¦°ì§€ ì…ë ¥ê¸°</h1>
    <p>ìŠ¤í”„ë¦°íŠ¸ / ë§ˆë¼í†¤ / ì•„ì´ë””ì–´ Â· Hard/Soft ëª¨ë“œ Â· ê²°ê³¼ ê³µìœ </p>
  </header>

  <div class="wrap">

    <!-- ëª¨ë“œ ì„ íƒ -->
    <div class="card" id="modeCard">
      <h2>ëª¨ë“œ ì„ íƒ</h2>
      <div class="stack">
        <div class="row">
          <button id="btnSprint">ìŠ¤í”„ë¦°íŠ¸ ëª¨ë“œ</button>
          <!-- â–¼ ë¬¸êµ¬ë„ 5ì´ˆë¡œ ìˆ˜ì • -->
          <span class="muted">Â· 3/5/10/20/30ë¶„ Â· <b>5ì´ˆ</b> ë©ˆì¶”ë©´ ì‹¤íŒ¨</span>
        </div>
        <div class="row">
          <button id="btnMarathon">ë§ˆë¼í†¤ ëª¨ë“œ</button>
          <span class="muted">Â· ëª©í‘œ ê¸€ììˆ˜ + 40/60/90/120ë¶„ Â· ë¯¸ë‹¬ ì‹œ ì‹¤íŒ¨</span>
        </div>
        <div class="row">
          <button id="btnIdea">ì•„ì´ë””ì–´ ëª¨ë“œ</button>
          <span class="muted">Â· 10/20/30ë¶„ Â· <b>1ë¶„</b> ë¬´ì…ë ¥ ì‹œ ì‹¤íŒ¨</span>
        </div>
      </div>
    </div>

    <!-- ë‚œì´ë„ ì„ íƒ -->
    <div class="card hidden" id="difficultyCard">
      <h3>ë‚œì´ë„ ì„ íƒ</h3>
      <div class="difficulty-block">
        <button id="btnHard">ğŸ”¥ Hard</button>
        <span class="muted">ì‹¤íŒ¨ ì‹œ ì›ê³  ì‚­ì œ</span>
      </div>
      <div class="difficulty-block">
        <button id="btnSoft">ğŸŒ± Soft</button>
        <span class="muted">ì‹¤íŒ¨í•´ë„ ì›ê³  ë³´ì¡´ (ë©”ì‹œì§€ë§Œ í‘œì‹œ)</span>
      </div>
    </div>

    <!-- ìŠ¤í”„ë¦°íŠ¸ ì„¤ì • -->
    <div class="card hidden" id="sprintSetup">
      <h3>ìŠ¤í”„ë¦°íŠ¸ ì„¤ì •</h3>
      <div class="row">
        <label for="sprintDuration">ì„¸ì…˜ ì‹œê°„</label>
        <select id="sprintDuration">
          <option value="180">3ë¶„</option>
          <option value="300" selected>5ë¶„</option>
          <option value="600">10ë¶„</option>
          <!-- â–¼ ì¶”ê°€: 20ë¶„, 30ë¶„ -->
          <option value="1200">20ë¶„</option>
          <option value="1800">30ë¶„</option>
        </select>
        <button id="startSprint">ì‹œì‘</button>
        <button class="ghost" id="backFromSprint">ë’¤ë¡œ</button>
      </div>
      <div class="hr"></div>
      <!-- â–¼ ë¬¸êµ¬ë„ 5ì´ˆë¡œ ìˆ˜ì • -->
      <p class="muted">íƒ€ì´í•‘ì´ <b>5ì´ˆ ì´ìƒ</b> ë©ˆì¶”ë©´ ì¦‰ì‹œ ì‹¤íŒ¨.</p>
    </div>

    <!-- ë§ˆë¼í†¤ ì„¤ì • -->
    <div class="card hidden" id="marathonSetup">
      <h3>ë§ˆë¼í†¤ ì„¤ì •</h3>
      <div class="row">
        <label for="targetChars">ëª©í‘œ ê¸€ììˆ˜</label>
        <input type="number" id="targetChars" min="500" step="100" value="4000" />
        <label for="marathonDuration" style="margin-left:10px">ì„¸ì…˜ ì‹œê°„</label>
        <select id="marathonDuration">
          <option value="2400" selected>40ë¶„</option>
          <option value="3600">1ì‹œê°„</option>
          <option value="5400">1ì‹œê°„ 30ë¶„</option>
          <option value="7200">2ì‹œê°„</option>
        </select>
        <button id="startMarathon">ì‹œì‘</button>
        <button class="ghost" id="backFromMarathon">ë’¤ë¡œ</button>
      </div>
      <div class="hr"></div>
      <p class="muted"><b>ì‹œê°„ ë‚´ ëª©í‘œ ê¸€ììˆ˜ ë¯¸ë‹¬</b> ì‹œ ì‹¤íŒ¨ ì²˜ë¦¬.</p>
    </div>

    <!-- ì•„ì´ë””ì–´ ì„¤ì • -->
    <div class="card hidden" id="ideaSetup">
      <h3>ì•„ì´ë””ì–´ ëª¨ë“œ ì„¤ì •</h3>
      <div class="row">
        <label for="ideaDuration">ì„¸ì…˜ ì‹œê°„</label>
        <select id="ideaDuration" aria-label="ì•„ì´ë””ì–´ ì‹œê°„">
          <option value="600" selected>10ë¶„</option>
          <option value="1200">20ë¶„</option>
          <option value="1800">30ë¶„</option>
        </select>
        <button id="startIdea">ì‹œì‘</button>
        <button class="ghost" id="backFromIdea">ë’¤ë¡œ</button>
      </div>
      <div class="hr"></div>
      <p class="muted">ê·œì¹™: <b>1ë¶„ ì´ìƒ</b> í‚¤ ì…ë ¥ì´ ì—†ìœ¼ë©´ ì¦‰ì‹œ ì‹¤íŒ¨. (ê¸€ììˆ˜ ëª©í‘œ ì—†ìŒ)</p>
    </div>

    <!-- ê¸€ì“°ê¸° í™”ë©´ -->
    <div class="card hidden" id="writingCard">
      <h3 id="sessionTitle">ì„¸ì…˜ ì§„í–‰ì¤‘</h3>
      <div class="stats">
        <div class="stat"><div class="muted">ë‚¨ì€ ì‹œê°„</div><div class="timer" id="timeLeft">--:--</div></div>
        <div class="stat"><div class="muted">í˜„ì¬ ê¸€ììˆ˜</div><div id="charCount">0</div></div>
        <div class="stat hidden" id="goalBox"><div class="muted">ëª©í‘œ ê¸€ììˆ˜</div><div id="goalChars">0</div></div>
      </div>

      <div id="progressWrap" class="hidden">
        <div class="progress-line">
          <span id="progressLabel">ì§„í–‰: 0 / 0 (0%)</span>
          <span class="muted" id="paceHint"></span>
        </div>
        <div class="progress-wrap" aria-label="ì§„í–‰ë¥ ">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </div>

      <div class="hr"></div>
      <textarea id="editor" placeholder="ì—¬ê¸°ì— ì›ê³ /ì•„ì´ë””ì–´ë¥¼ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
      <p id="statusLine" class="center muted">ì…ë ¥ ëŒ€ê¸° ì¤‘â€¦</p>
      <div class="center">
        <button class="danger" id="giveUp">í¬ê¸°(ì¦‰ì‹œ ì¢…ë£Œ)</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div class="card hidden" id="resultCard">
      <h3 id="resultHeadline">ê²°ê³¼</h3>
      <p id="resultDetail" class="center"></p>
      <div class="center" style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:8px">
        <button id="restart">ë‹¤ì‹œ ì‹œì‘</button>
      </div>
      <div class="share-buttons">
        <button id="shareKakao">ì¹´ì¹´ì˜¤í†¡</button>
        <button id="shareTwitter">X(íŠ¸ìœ„í„°)</button>
        <button id="shareCopy">ğŸ“‹ ë³µì‚¬</button>
      </div>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // ===== DOM =====
      const modeCard = document.getElementById('modeCard');
      const difficultyCard = document.getElementById('difficultyCard');
      const sprintSetup = document.getElementById('sprintSetup');
      const marathonSetup = document.getElementById('marathonSetup');
      const ideaSetup = document.getElementById('ideaSetup');
      const writingCard = document.getElementById('writingCard');
      const resultCard = document.getElementById('resultCard');

      const btnSprint = document.getElementById('btnSprint');
      const btnMarathon = document.getElementById('btnMarathon');
      const btnIdea = document.getElementById('btnIdea');

      const btnHard = document.getElementById('btnHard');
      const btnSoft = document.getElementById('btnSoft');

      const backFromSprint = document.getElementById('backFromSprint');
      const backFromMarathon = document.getElementById('backFromMarathon');
      const backFromIdea = document.getElementById('backFromIdea');

      const startSprintBtn = document.getElementById('startSprint');
      const startMarathonBtn = document.getElementById('startMarathon');
      const startIdeaBtn = document.getElementById('startIdea');

      const sprintDurationSel = document.getElementById('sprintDuration');
      const marathonDurationSel = document.getElementById('marathonDuration');
      const targetCharsInput = document.getElementById('targetChars');
      const ideaDurationSel = document.getElementById('ideaDuration');

      const sessionTitle = document.getElementById('sessionTitle');
      const timeLeftEl = document.getElementById('timeLeft');
      const charCountEl = document.getElementById('charCount');
      const goalBox = document.getElementById('goalBox');
      const goalCharsEl = document.getElementById('goalChars');

      const progressWrap = document.getElementById('progressWrap');
      const progressBar = document.getElementById('progressBar');
      const progressLabel = document.getElementById('progressLabel');
      const paceHint = document.getElementById('paceHint');

      const editor = document.getElementById('editor');

// â–¼ ì´ˆì•ˆ ì €ì¥ í‚¤
const DRAFT_KEY = 'novel:autosave';

// â–¼ ì´ˆì•ˆ ì €ì¥/ë³µì› ìœ í‹¸
function saveDraft(){
  try { localStorage.setItem(DRAFT_KEY, editor.value); } catch(e) {}
}
function loadDraft(){
  try {
    const v = localStorage.getItem(DRAFT_KEY);
    if (v != null) editor.value = v;
  } catch(e) {}
}

// â–¼ ì°½ ë‹«ê¸°/ìƒˆë¡œê³ ì¹¨ ì‹œ ìë™ ì €ì¥
window.addEventListener('beforeunload', saveDraft);

const statusLine = document.getElementById('statusLine');

      const giveUpBtn = document.getElementById('giveUp');

      const resultHeadline = document.getElementById('resultHeadline');
      const resultDetail = document.getElementById('resultDetail');
      const restartBtn = document.getElementById('restart');

      const shareTwitter = document.getElementById('shareTwitter');
      const shareKakao = document.getElementById('shareKakao');
      const shareCopy = document.getElementById('shareCopy');

      // ===== ìƒíƒœ =====
      let mode = null;          // 'sprint' | 'marathon' | 'idea'
      let difficulty = null;    // 'hard' | 'soft'
      let totalSeconds = 0;
      let remain = 0;
      let timerId = null;
      let idleTimeoutId = null;
      const IDEA_IDLE_LIMIT = 60; // ì•„ì´ë””ì–´: 1ë¶„ ë¬´ì…ë ¥ ì‹¤íŒ¨
      const SPRINT_IDLE_LIMIT = 5; // â–¼ ìŠ¤í”„ë¦°íŠ¸: 5ì´ˆ ë¬´ì…ë ¥ ì‹¤íŒ¨ (ë³€ê²½)

      // â–¼ ì¶”ê°€: í¬ì»¤ìŠ¤/ê°€ë“œ ìƒíƒœ
      let isPaused = false;
      let sessionEnded = false;   // ì„±ê³µ/ì‹¤íŒ¨ ë“± ìµœì¢… ì¢…ë£Œ ì—¬ë¶€

      // ===== ìœ í‹¸ =====
      const fmt = s => { const m=Math.floor(s/60), sec=s%60; return `${m}:${sec<10?'0'+sec:sec}`; };
      const show = el => el.classList.remove('hidden');
      const hide = el => el.classList.add('hidden');

      function resetToHome(){
        clearInterval(timerId); timerId = null;
        clearTimeout(idleTimeoutId); idleTimeoutId = null;

        editor.disabled = false;
        editor.value = ''; editor.oninput = null; editor.onkeydown = null;
        editor.removeAttribute('data-target');

        timeLeftEl.textContent = '--:--';
        charCountEl.textContent = '0';
        goalCharsEl.textContent = '0';
        statusLine.textContent = 'ì…ë ¥ ëŒ€ê¸° ì¤‘â€¦'; statusLine.className = 'center muted';
        progressBar.style.width = '0%'; progressLabel.textContent = 'ì§„í–‰: 0 / 0 (0%)'; paceHint.textContent = '';

        hide(writingCard); hide(resultCard); hide(sprintSetup); hide(marathonSetup); hide(ideaSetup); hide(difficultyCard);
        show(modeCard);

        mode = null; difficulty = null; totalSeconds = 0; remain = 0;


        // â–¼ ìƒíƒœ ì´ˆê¸°í™”
        isPaused = false;
        sessionEnded = false;
      }

      // ===== ë„¤ë¹„ê²Œì´ì…˜ =====
      btnSprint.onclick = () => { mode = 'sprint'; hide(modeCard); show(difficultyCard); };
      btnMarathon.onclick = () => { mode = 'marathon'; hide(modeCard); show(difficultyCard); };
      btnIdea.onclick = () => { mode = 'idea'; hide(modeCard); show(difficultyCard); };

      btnHard.onclick = () => { difficulty = 'hard'; goSetup(); };
      btnSoft.onclick = () => { difficulty = 'soft'; goSetup(); };

      function goSetup(){
        hide(difficultyCard);
        if(mode==='sprint') show(sprintSetup);
        else if(mode==='marathon') show(marathonSetup);
        else if(mode==='idea') show(ideaSetup);
      }

      backFromSprint.onclick = () => { hide(sprintSetup); show(modeCard); mode=null; difficulty=null; };
      backFromMarathon.onclick = () => { hide(marathonSetup); show(modeCard); mode=null; difficulty=null; };
      backFromIdea.onclick = () => { hide(ideaSetup); show(modeCard); mode=null; difficulty=null; };

      // ===== ì‹œì‘ =====
      startSprintBtn.onclick = () => {
        totalSeconds = parseInt(sprintDurationSel.value,10);
        startSession();
      };
      startMarathonBtn.onclick = () => {
        const target = parseInt(targetCharsInput.value,10);
        if (isNaN(target) || target < 500){ alert('ëª©í‘œ ê¸€ììˆ˜ë¥¼ 500ì ì´ìƒìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        totalSeconds = parseInt(marathonDurationSel.value,10);
        startSession(target);
      };
      startIdeaBtn.onclick = () => {
        totalSeconds = parseInt(ideaDurationSel.value,10);
        startSession();
      };

      function startSession(targetChars=null){
        hide(modeCard); hide(difficultyCard); hide(sprintSetup); hide(marathonSetup); hide(ideaSetup);
        show(writingCard);

        // â–¼ ì„¸ì…˜ ê°€ë“œ ì´ˆê¸°í™”
        sessionEnded = false;
        isPaused = false;

        if(mode==='sprint'){
          sessionTitle.textContent = `ìŠ¤í”„ë¦°íŠ¸ ì§„í–‰ì¤‘ (${fmt(totalSeconds)}) â€” 5ì´ˆ ë©ˆì¶”ë©´ ì‹¤íŒ¨`;
          hide(goalBox); hide(progressWrap);
        }else if(mode==='marathon'){
          sessionTitle.textContent = `ë§ˆë¼í†¤ ì§„í–‰ì¤‘ (${fmt(totalSeconds)}) â€” ëª©í‘œ ê¸€ììˆ˜ ë‹¬ì„± í•„ìˆ˜`;
          goalCharsEl.textContent = String(targetChars);
          show(goalBox); show(progressWrap);
          editor.dataset.target = String(targetChars);
        }else{
          sessionTitle.textContent = `ì•„ì´ë””ì–´ ëª¨ë“œ ì§„í–‰ì¤‘ (${fmt(totalSeconds)}) â€” 1ë¶„ ë¬´ì…ë ¥ ì‹œ ì‹¤íŒ¨`;
          hide(goalBox); hide(progressWrap);
        }
editor.disabled = false;
editor.value = '';
loadDraft();  // â† ì €ì¥ë³¸ ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
charCountEl.textContent = String(editor.value.length); // ë³µì›ëœ ê¸¸ì´ ë°˜ì˜
statusLine.textContent = 'ì…ë ¥ ëŒ€ê¸° ì¤‘â€¦';
statusLine.className = 'center muted';

editor.oninput = () => {
  saveDraft(); // â† ì…ë ¥ ì‹œë§ˆë‹¤ ìë™ ì €ì¥
  charCountEl.textContent = String(editor.value.length);
  if(mode==='sprint') resetIdle(SPRINT_IDLE_LIMIT);
  if(mode==='idea')   resetIdle(IDEA_IDLE_LIMIT);
  if(mode==='marathon') updateProgress();
};

        editor.onkeydown = () => {
          if(mode==='sprint') resetIdle(SPRINT_IDLE_LIMIT);     // â–¼ 5ì´ˆë¡œ ë™ì‘
          if(mode==='idea')   resetIdle(IDEA_IDLE_LIMIT);
        };

        remain = totalSeconds;
        timeLeftEl.textContent = fmt(remain);
        clearInterval(timerId); timerId = setInterval(tick,1000);

        if(mode==='sprint')  resetIdle(SPRINT_IDLE_LIMIT);      // â–¼ 5ì´ˆë¡œ ë™ì‘
        if(mode==='idea')    resetIdle(IDEA_IDLE_LIMIT);
        if(mode==='marathon') updateProgress();

        editor.focus();
      }

      function tick(){
        // â–¼ ìˆ¨ê¹€/ì¼ì‹œì •ì§€/í¬ì»¤ìŠ¤ ì´íƒˆ ì¤‘ì—ëŠ” ì§„í–‰ ê¸ˆì§€
        if (sessionEnded || isPaused || document.hidden || !document.hasFocus()) return;

        remain--;
        timeLeftEl.textContent = fmt(remain);
        if(mode==='marathon') updateProgress();

        if(remain<=0){
          clearInterval(timerId);
          // ì¢…ë£Œ ì§ì „ í˜¹ì‹œ ë‚¨ì€ idle íƒ€ì´ë¨¸ë„ ì œê±°
          clearTimeout(idleTimeoutId); idleTimeoutId=null;
          if(mode==='sprint'){
            success(`ìŠ¤í”„ë¦°íŠ¸ ì„±ê³µ! ${fmt(totalSeconds)} ë™ì•ˆ ë©ˆì¶”ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
          }else if(mode==='marathon'){
            const target = parseInt(editor.dataset.target || '0',10);
            const len = editor.value.length;
            if(len >= target){
              success(`ë§ˆë¼í†¤ ì„±ê³µ! ${fmt(totalSeconds)} ë‚´ì— ${len.toLocaleString()}ì ì‘ì„± (ëª©í‘œ ${target.toLocaleString()}ì).`);
            }else{
              fail(`ë§ˆë¼í†¤ ì‹¤íŒ¨! ${fmt(totalSeconds)} ë‚´ì— ${len.toLocaleString()}ì / ëª©í‘œ ${target.toLocaleString()}ì ë¯¸ë‹¬.`, true);
            }
          }else{
            success(`ì•„ì´ë””ì–´ ëª¨ë“œ ì„±ê³µ! ${fmt(totalSeconds)} ë™ì•ˆ ë©ˆì¶”ì§€ ì•Šê³  ë¸Œë ˆì¸ìŠ¤í† ë° ì™„ë£Œ.`);
          }
        }
      }

      function updateProgress(){
        const target = parseInt(editor.dataset.target || '0',10);
        if(!target){ hide(progressWrap); return; }
        const len = editor.value.length;
        const pct = Math.max(0, Math.min(100, Math.round((len/target)*100)));
        progressBar.style.width = pct + '%';
        progressLabel.textContent = `ì§„í–‰: ${len.toLocaleString()} / ${target.toLocaleString()} (${pct}%)`;
        if(remain > 0){
          const need = Math.max(0, target - len);
          const needPerMin = Math.ceil(need / (remain/60));
          paceHint.textContent = `í•„ìš” ì†ë„: ë¶„ë‹¹ ${needPerMin.toLocaleString()}ì`;
        }else{
          paceHint.textContent = '';
        }
      }

      function resetIdle(seconds){
        clearTimeout(idleTimeoutId);
        const ruleText = (mode==='sprint') ? '5ì´ˆ ì´ìƒ ë©ˆì¶”ë©´ ì‹¤íŒ¨' : (mode==='idea') ? '1ë¶„ ë¬´ì…ë ¥ ì‹œ ì‹¤íŒ¨' : '';
        statusLine.textContent = `ì…ë ¥ ì¤‘â€¦ (${ruleText})`;
        statusLine.className = 'center muted';
        idleTimeoutId = setTimeout(()=>{
          // â–¼ ì„¸ì…˜ì´ ëë‚¬ê±°ë‚˜ ì‹œê°„ ì¢…ë£Œëœ ë’¤ ì§€ì—° íƒ€ì´ë¨¸ê°€ ê¹¨ì–´ë‚˜ë©´ ë¬´ì‹œ
          if (sessionEnded || remain <= 0) return;
          if (mode==='sprint'){
            fail('ìŠ¤í”„ë¦°íŠ¸ ì‹¤íŒ¨! 5ì´ˆ ì´ìƒ íƒ€ì´í•‘ì´ ë©ˆì·„ìŠµë‹ˆë‹¤.', true); // â–¼ ë©”ì‹œì§€ë„ 5ì´ˆ
          }else if(mode==='idea'){
            fail('ì•„ì´ë””ì–´ ëª¨ë“œ ì‹¤íŒ¨! 1ë¶„ ì´ìƒ ì…ë ¥ì´ ì—†ì—ˆìŠµë‹ˆë‹¤.', true);
          }
        }, seconds*1000);
      }

      function success(msg){
        // â–¼ ì¤‘ë³µ/ì§€ì—° ì„±ê³µ í˜¸ì¶œ ë°©ì§€
        if (sessionEnded) return;
        sessionEnded = true;

saveDraft(); // âœ… ìµœì¢…ë³¸ ëª…ì‹œ ì €ì¥

        stopTimersKeepEditor();
        resultHeadline.textContent = 'ğŸ‰ ì„±ê³µ';
        resultHeadline.className = 'success center';
        resultDetail.textContent = msg + ' (ì›ê³ ëŠ” ì•„ë˜ ì—ë””í„°ì— ê·¸ëŒ€ë¡œ ë³´ì¡´ë©ë‹ˆë‹¤)';
        show(resultCard);
      }

      function fail(msg, wipe=false){
        // â–¼ ì¤‘ë³µ/ì§€ì—° ì‹¤íŒ¨ í˜¸ì¶œ ë°©ì§€
        if (sessionEnded) return;
        // â–¼ íƒ­ì´ ìˆ¨ê¹€ì´ê±°ë‚˜ í¬ì»¤ìŠ¤ê°€ ì—†ì„ ë•ŒëŠ” ì‹¤íŒ¨ ì²˜ë¦¬ ê¸ˆì§€
        if (document.hidden || !document.hasFocus()) return;

        sessionEnded = true;

        stopTimersKeepEditor();
        if(difficulty==='hard' && wipe){
          editor.value = '';
          charCountEl.textContent = '0';
          try { localStorage.removeItem(DRAFT_KEY); } catch(e) {}
          resultDetail.textContent = msg + ' (Hard ëª¨ë“œ â€” ì›ê³ ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤)';
        }else{
saveDraft(); // âœ… Soft ì‹¤íŒ¨(ë˜ëŠ” hardì´ì§€ë§Œ wipe=false) ì‹œ ìµœì¢…ë³¸ ì €ì¥
          resultDetail.textContent = msg + ' (Soft ëª¨ë“œ â€” ì›ê³ ê°€ ë³´ì¡´ë©ë‹ˆë‹¤)';
        }
        resultHeadline.textContent = 'âš ï¸ ì‹¤íŒ¨';
        resultHeadline.className = 'fail center';
        show(resultCard);
      }

      function stopTimersKeepEditor(){
        clearInterval(timerId);
        clearTimeout(idleTimeoutId);
        timerId = null; idleTimeoutId = null;
        editor.disabled = false;
        show(writingCard);
      }

      giveUpBtn.onclick = ()=>{
        if(confirm('ì •ë§ í¬ê¸°í•˜ì‹œê² ì–´ìš”?')){
          fail('ì‚¬ìš©ì ì¤‘ë‹¨', true);
        }
      };

      restartBtn.onclick = resetToHome;

      // ê³µìœ 
      function getShareText(){
        const baseUrl = (location.origin + location.pathname);
        return `${resultDetail.innerText}\në°”ë¡œ í•´ë³´ê¸°: ${baseUrl}`;
      }
      shareKakao.onclick = async ()=>{
        const text = getShareText();
        const shareData = { title:'ê¸€ì“°ê¸° ë£¨í‹´ ì±Œë¦°ì§€ ì…ë ¥ê¸°', text, url: location.href };
        if(navigator.share){
          try{ await navigator.share(shareData); return; }catch(e){}
        }
        try{ await navigator.clipboard.writeText(text); alert('ê³µìœ  í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ëì–´ìš”! ì¹´ì¹´ì˜¤í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.'); }
        catch(e){ alert('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ ë³µì‚¬ ë¶€íƒë“œë ¤ìš”.'); }
      };
      shareTwitter.onclick = ()=>{ const t=encodeURIComponent(getShareText()); window.open(`https://twitter.com/intent/tweet?text=${t}`,'_blank'); };
      shareCopy.onclick = async ()=>{ try{ await navigator.clipboard.writeText(getShareText()); alert('ê²°ê³¼ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); }catch(e){ alert('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ ë³µì‚¬ ë¶€íƒë“œë ¤ìš”!'); } };

      // â–¼ ì¼ì‹œì •ì§€/ì¬ê°œ ë¡œì§
      function pauseSession(reason='í¬ì»¤ìŠ¤ ì´íƒˆ'){
        if (isPaused || sessionEnded) return;
        isPaused = true;
        clearInterval(timerId); timerId = null;
        clearTimeout(idleTimeoutId); idleTimeoutId = null;
        statusLine.textContent = `ì¼ì‹œì •ì§€ (${reason}) â€” ì°½ìœ¼ë¡œ ëŒì•„ì˜¤ë©´ ìë™ ì¬ê°œ`;
        statusLine.className = 'center muted';
      }

      function resumeSession(){
        if (!isPaused || sessionEnded) return;
        isPaused = false;
        // ì¹´ìš´íŠ¸ë‹¤ìš´ ì¬ê°œ
        timerId = setInterval(tick, 1000);
        // ìœ íœ´ê°ì§€ ì¬ê°œ
        if (mode==='sprint') resetIdle(SPRINT_IDLE_LIMIT);
        if (mode==='idea')   resetIdle(IDEA_IDLE_LIMIT);
        statusLine.textContent = 'ì…ë ¥ ì¤‘â€¦';
        statusLine.className = 'center muted';
      }

      // â–¼ íƒ­/ì°½ í¬ì»¤ìŠ¤ì— ë”°ë¥¸ ì¼ì‹œì •ì§€Â·ì¬ê°œ (ê¸€ì“°ê¸° í™”ë©´ì—ì„œë§Œ)
      document.addEventListener('visibilitychange', ()=>{
        if (sessionEnded || !writingCard || writingCard.classList.contains('hidden')) return;
        if (document.hidden) pauseSession('íƒ­ ìˆ¨ê¹€');
        else if (document.hasFocus()) resumeSession();
      });

      window.addEventListener('blur', ()=>{
        if (sessionEnded) return;
        if (!writingCard.classList.contains('hidden')) pauseSession('í¬ì»¤ìŠ¤ ì´íƒˆ');
      });
      window.addEventListener('focus', ()=>{
        if (sessionEnded) return;
        if (!writingCard.classList.contains('hidden') && !document.hidden) resumeSession();
      });
    });
  </script>
</body>
</html>


